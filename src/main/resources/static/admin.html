<!DOCTYPE html>
<html lang="en" role="application">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Numbers - Dashboard</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/chartjs-chart-geo@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css">

    <!-- Leaflet for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/admin-panel/css/variables.css">
    <link rel="stylesheet" href="/admin-panel/css/base.css">
    <link rel="stylesheet" href="/admin-panel/css/themes.css">
    <link rel="stylesheet" href="/admin-panel/css/components.css">
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main" class="skip-link" tabindex="0">Skip to main content</a>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
        <i class="ri-menu-line"></i>
    </button>

    <!-- Sidebar -->
    <nav id="sidebar" role="navigation" aria-label="Main navigation">
        <div class="sidebar-header">
            <h2>Mini Numbers</h2>
            <div class="sidebar-subtitle">Privacy-first analytics</div>
        </div>

        <div class="sidebar-section" id="projects-section">
            <div class="sidebar-section__title">
                <i class="ri-folder-line"></i>
                <span>Your projects</span>
            </div>
            <div id="project-menu" class="project-menu" role="listbox" aria-label="Projects list">
                Loading projects...
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="btn btn-ghost sidebar-btn" id="demo-project-btn" onclick="Dashboard.createOrBrowseDemoProject()">
                <i class="ri-play-circle-line"></i>
                <span>Demo project</span>
            </button>
            <button class="btn btn-primary sidebar-btn" id="new-project-btn" onclick="Dashboard.showCreateProjectDialog()">
                <i class="ri-add-line"></i>
                <span>New project</span>
            </button>
            <button class="btn btn-ghost sidebar-btn" id="sign-out-btn">
                <i class="ri-logout-box-r-line"></i>
                <span>Sign out</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main" role="main">
        <!-- Header -->
        <div class="dashboard-header">
            <h1 id="active-title">Select a project</h1>
            <div class="flex items-center gap-md">
                <button class="btn btn-secondary btn-sm" id="generate-demo-btn" style="display: none;">
                    <i class="ri-database-2-line"></i>
                    <span>Generate demo data</span>
                </button>
                <button class="btn btn-secondary btn-sm" id="view-raw-events-btn" style="display: none;">
                    <i class="ri-list-unordered"></i>
                    <span>Raw events</span>
                </button>
                <select class="select" id="time-filter" aria-label="Time period filter">
                    <option value="24h">Last 24 hours</option>
                    <option value="3d">Last 3 days</option>
                    <option value="7d" selected>Last 7 days</option>
                    <option value="30d">Last 30 days</option>
                    <option value="365d">Last year</option>
                </select>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                    <div class="theme-toggle__slider">
                        <i class="ri-sun-line"></i>
                    </div>
                </button>
                <button class="btn btn-ghost btn-icon" id="open-settings-btn" title="Settings">
                    <i class="ri-settings-3-line"></i>
                </button>
            </div>
        </div>

        <!-- Dashboard Content (hidden until project selected) -->
        <div id="dashboard-content" class="hidden">

            <!-- Unified Filter Bar with Date Range -->
            <div class="filter-bar" id="filter-bar">
                <div class="filter-bar__date-range">
                    <i class="ri-calendar-line"></i>
                    <span id="date-range-display">Loading...</span>
                </div>

                <div class="filter-bar__divider"></div>

                <div class="filter-selector">
                    <label>Filter by:</label>
                    <select id="filter-dimension" class="select">
                        <option value="">All traffic</option>
                        <option value="browser">Browser</option>
                        <option value="os">Operating system</option>
                        <option value="device">Device</option>
                        <option value="country">Country</option>
                        <option value="referrer">Referrer</option>
                    </select>
                </div>

                <div class="filter-value" id="filter-value-container" style="display: none;">
                    <select id="filter-value" class="select"></select>
                    <button class="btn btn-ghost btn-sm" id="clear-filter">Clear</button>
                </div>

                <div class="filter-warning" style="display: none;">
                    <i class="ri-error-warning-line"></i>
                    <span>Filtered view - totals show all traffic</span>
                </div>
            </div>

            <!-- ============================================
                 SECTION 1: OVERVIEW
                 ============================================ -->
            <section class="dashboard-section" data-section="overview" aria-expanded="true">
                <button class="dashboard-section__header" aria-expanded="true" aria-controls="section-overview-content">
                    <div class="dashboard-section__title">
                        <i class="ri-dashboard-line"></i>
                        <div>
                            <h2>Overview</h2>
                            <p>High-level performance snapshot — page views, visitors, sessions, bounce rate, and trends for the selected time range compared to the previous period.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-overview-content">
                    <!-- Primary Stat Cards -->
                    <div class="grid grid-cols-3" role="region" aria-label="Key metrics">
                        <div class="card stat-card" role="status" aria-label="Total page views">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-eye-line"></i></div>
                                <small>Total page views</small>
                            </div>
                            <div class="stat-card__value" id="total-views"><span class="skeleton skeleton-text" style="width: 60px;">&nbsp;</span></div>
                            <canvas id="sparkline-views" class="stat-card__sparkline"></canvas>
                            <div class="stat-card__comparison" id="views-comparison">Loading...</div>
                        </div>

                        <div class="card stat-card" role="status" aria-label="Unique visitors">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-group-line"></i></div>
                                <small>Unique visitors</small>
                            </div>
                            <div class="stat-card__value" id="unique-visitors"><span class="skeleton skeleton-text" style="width: 60px;">&nbsp;</span></div>
                            <canvas id="sparkline-visitors" class="stat-card__sparkline"></canvas>
                            <div class="stat-card__comparison" id="visitors-comparison">Loading...</div>
                        </div>

                        <div class="card stat-card" role="status" aria-label="Bounce rate">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-logout-box-r-line"></i></div>
                                <small>Bounce rate</small>
                            </div>
                            <div class="stat-card__value" id="bounce-rate"><span class="skeleton skeleton-text" style="width: 50px;">&nbsp;</span></div>
                            <div class="stat-card__comparison" id="bounce-comparison">Loading...</div>
                        </div>
                    </div>

                    <!-- Extended Metrics -->
                    <div class="grid grid-cols-3 mt-lg" role="region" aria-label="Extended metrics">
                        <div class="card stat-card" role="status" aria-label="Total sessions">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-stack-line"></i></div>
                                <small>Total sessions</small>
                            </div>
                            <div class="stat-card__value" id="total-sessions"><span class="skeleton skeleton-text" style="width: 60px;">&nbsp;</span></div>
                            <div class="stat-card__comparison" id="sessions-comparison">Loading...</div>
                        </div>

                        <div class="card stat-card" role="status" aria-label="Average session duration">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-timer-line"></i></div>
                                <small>Avg. session duration</small>
                            </div>
                            <div class="stat-card__value" id="avg-session-duration"><span class="skeleton skeleton-text" style="width: 60px;">&nbsp;</span></div>
                            <div class="stat-card__comparison" id="session-duration-comparison">Loading...</div>
                        </div>

                        <div class="card stat-card" role="status" aria-label="Conversion rate">
                            <div class="stat-card__header">
                                <div class="stat-card__icon" aria-hidden="true"><i class="ri-exchange-funds-line"></i></div>
                                <small>Conversion rate</small>
                            </div>
                            <div class="stat-card__value" id="overall-conversion-rate"><span class="skeleton skeleton-text" style="width: 50px;">&nbsp;</span></div>
                            <div class="stat-card__comparison" id="conversion-rate-comparison">Loading...</div>
                        </div>
                    </div>

                    <!-- Views over Time -->
                    <div class="card chart-card mt-lg">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-line-chart-line"></i> Views over time
                            </h3>
                        </div>
                        <div class="chart-card__container">
                            <canvas id="chart-timeseries"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 2: CONTENT & PAGES
                 ============================================ -->
            <section class="dashboard-section" data-section="content" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-content-content">
                    <div class="dashboard-section__title">
                        <i class="ri-file-text-line"></i>
                        <div>
                            <h2>Content & Pages</h2>
                            <p>Which pages attract the most traffic, where visitors enter and leave your site, how far they scroll, and which outbound links and downloads they click.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-content-content">
                    <!-- Top Pages -->
                    <div class="card chart-card">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-file-text-line"></i> Top pages
                            </h3>
                        </div>
                        <div class="chart-card__container chart-card__container--short">
                            <canvas id="chart-pages"></canvas>
                        </div>
                    </div>

                    <!-- Entry & Exit Pages -->
                    <div class="grid grid-cols-2 mt-lg" id="entry-exit-section" style="display: none;">
                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-login-box-line"></i> Entry pages
                                </h3>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-entry-pages"></canvas>
                            </div>
                        </div>
                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-logout-box-line"></i> Exit pages
                                </h3>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-exit-pages"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Scroll Depth -->
                    <div class="card chart-card mt-lg" id="scroll-depth-section" style="display: none;">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-arrow-down-double-line"></i> Scroll depth
                            </h3>
                        </div>
                        <div class="chart-card__container chart-card__container--short">
                            <canvas id="chart-scroll-depth"></canvas>
                        </div>
                    </div>

                    <!-- Outbound Links & File Downloads -->
                    <div class="grid grid-cols-2 mt-lg" id="outbound-section" style="display: none;">
                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-external-link-line"></i> Outbound links
                                </h3>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-outbound-links"></canvas>
                            </div>
                        </div>
                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-download-2-line"></i> File downloads
                                </h3>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-file-downloads"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 3: TRAFFIC SOURCES
                 ============================================ -->
            <section class="dashboard-section" data-section="traffic" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-traffic-content">
                    <div class="dashboard-section__title">
                        <i class="ri-route-line"></i>
                        <div>
                            <h2>Traffic Sources</h2>
                            <p>Referral sites driving traffic to you, plus UTM campaign breakdowns by source, medium, and campaign name for tracking marketing efforts.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-traffic-content">
                    <!-- Referrers -->
                    <div class="card chart-card">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-external-link-line"></i> Referrers
                            </h3>
                        </div>
                        <div class="chart-card__container chart-card__container--short">
                            <canvas id="chart-referrers"></canvas>
                        </div>
                    </div>

                    <!-- UTM Campaigns -->
                    <div class="card chart-card mt-lg" id="utm-section" style="display: none;">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-megaphone-line"></i> UTM campaigns
                            </h3>
                        </div>
                        <div class="grid grid-cols-3" style="gap: var(--spacing-md); padding: var(--spacing-md);">
                            <div>
                                <h4 class="text-sm text-muted mb-sm">Sources</h4>
                                <div class="chart-card__container chart-card__container--short">
                                    <canvas id="chart-utm-sources"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm text-muted mb-sm">Mediums</h4>
                                <div class="chart-card__container chart-card__container--short">
                                    <canvas id="chart-utm-mediums"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm text-muted mb-sm">Campaigns</h4>
                                <div class="chart-card__container chart-card__container--short">
                                    <canvas id="chart-utm-campaigns"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 4: AUDIENCE & TECHNOLOGY
                 ============================================ -->
            <section class="dashboard-section" data-section="audience" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-audience-content">
                    <div class="dashboard-section__title">
                        <i class="ri-group-line"></i>
                        <div>
                            <h2>Audience & Technology</h2>
                            <p>Geographic distribution of your visitors with country and city drill-down, plus browser, operating system, and device type breakdowns.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-audience-content">
                    <!-- Geographic Distribution -->
                    <div class="card chart-card">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <button id="geo-back-btn" class="btn btn-ghost btn-icon" style="display: none; margin-right: 0.5rem;">
                                    <i class="ri-arrow-left-line"></i>
                                </button>
                                <i class="ri-map-2-line"></i>
                                <span id="geo-title">Geographic distribution</span>
                            </h3>
                            <div class="chart-card__actions">
                                <div class="view-toggle" id="geo-view-toggle">
                                    <button class="view-toggle__btn active" data-view="chart" title="Chart view">
                                        <i class="ri-bar-chart-line"></i>
                                    </button>
                                    <button class="view-toggle__btn" data-view="globe" title="Globe view">
                                        <i class="ri-earth-line"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-card__container chart-card__container--tall">
                            <canvas id="chart-countries"></canvas>
                            <div id="map-countries" class="map-container hidden"></div>
                            <div id="globe-container" class="globe-container hidden">
                                <div class="globe-range-selector" id="globe-range-selector">
                                    <button class="globe-range-btn active" data-range="realtime">
                                        <span class="live-indicator" aria-hidden="true"></span> Real-time
                                    </button>
                                    <button class="globe-range-btn" data-range="1m">1 min</button>
                                    <button class="globe-range-btn" data-range="1h">1 hour</button>
                                    <button class="globe-range-btn" data-range="1d">1 day</button>
                                    <button class="globe-range-btn" id="globe-test-markers-btn" title="Show 10 test markers">
                                        <i class="ri-map-pin-line"></i> Test
                                    </button>
                                </div>
                                <div id="globe-canvas" class="globe-canvas"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Regions / States -->
                    <div class="card chart-card mt-lg" id="regions-section" style="display: none;">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-map-pin-2-line"></i> Regions / States
                            </h3>
                        </div>
                        <div class="chart-card__container chart-card__container--short">
                            <canvas id="chart-regions"></canvas>
                        </div>
                    </div>

                    <!-- Browsers, Operating Systems & Devices -->
                    <div class="grid grid-cols-3 mt-lg">
                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-global-line"></i> Browsers
                                </h3>
                                <div class="chart-card__actions">
                                    <div class="view-toggle" data-chart="browsers">
                                        <button class="view-toggle__btn active" data-view="doughnut" title="Doughnut chart">
                                            <i class="ri-pie-chart-2-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="bar" title="Bar chart">
                                            <i class="ri-bar-chart-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="radar" title="Radar chart">
                                            <i class="ri-focus-3-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-browsers"></canvas>
                            </div>
                        </div>

                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-computer-line"></i> OS
                                </h3>
                                <div class="chart-card__actions">
                                    <div class="view-toggle" data-chart="os">
                                        <button class="view-toggle__btn active" data-view="doughnut" title="Doughnut chart">
                                            <i class="ri-pie-chart-2-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="bar" title="Bar chart">
                                            <i class="ri-bar-chart-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="radar" title="Radar chart">
                                            <i class="ri-focus-3-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-os"></canvas>
                            </div>
                        </div>

                        <div class="card chart-card">
                            <div class="chart-card__header">
                                <h3 class="chart-card__title">
                                    <i class="ri-smartphone-line"></i> Devices
                                </h3>
                                <div class="chart-card__actions">
                                    <div class="view-toggle" data-chart="devices">
                                        <button class="view-toggle__btn active" data-view="doughnut" title="Doughnut chart">
                                            <i class="ri-pie-chart-2-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="bar" title="Bar chart">
                                            <i class="ri-bar-chart-line"></i>
                                        </button>
                                        <button class="view-toggle__btn" data-view="radar" title="Radar chart">
                                            <i class="ri-focus-3-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-card__container chart-card__container--short">
                                <canvas id="chart-devices"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 5: TIME PATTERNS
                 ============================================ -->
            <section class="dashboard-section" data-section="time-patterns" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-time-content">
                    <div class="dashboard-section__title">
                        <i class="ri-time-line"></i>
                        <div>
                            <h2>Time Patterns</h2>
                            <p>When your visitors are most active — an hourly/daily heatmap highlighting peak times, plus a 365-day contribution calendar showing long-term trends.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-time-content">
                    <!-- Activity Heatmap -->
                    <div class="card chart-card">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-calendar-line"></i> Activity heatmap
                            </h3>
                            <div class="chart-card__actions">
                                <div class="heatmap-legend">
                                    <span class="text-muted text-xs">Less</span>
                                    <div class="legend-gradient"></div>
                                    <span class="text-muted text-xs">More</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-card__container chart-card__container--tall">
                            <canvas id="chart-heatmap"></canvas>
                        </div>
                    </div>

                    <!-- Contribution Calendar -->
                    <div class="card chart-card mt-lg">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-pulse-line"></i> Activity calendar (last 365 days)
                            </h3>
                            <div class="contribution-legend">
                                <span class="text-muted text-xs">Less</span>
                                <div class="contribution-level" data-level="0"></div>
                                <div class="contribution-level" data-level="1"></div>
                                <div class="contribution-level" data-level="2"></div>
                                <div class="contribution-level" data-level="3"></div>
                                <div class="contribution-level" data-level="4"></div>
                                <span class="text-muted text-xs">More</span>
                            </div>
                        </div>
                        <div class="chart-card__container">
                            <div id="contribution-calendar" class="contribution-calendar">
                                Loading...
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 6: EVENTS & REVENUE
                 ============================================ -->
            <section class="dashboard-section" data-section="events" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-events-content">
                    <div class="dashboard-section__title">
                        <i class="ri-flashlight-line"></i>
                        <div>
                            <h2>Events & Revenue</h2>
                            <p>Custom events tracked via MiniNumbers.track(), revenue totals, average order value, and which referrers and campaigns generate actual income.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-events-content">
                    <!-- Custom Events (consolidated) -->
                    <div class="card chart-card" id="custom-events-section" style="display: none;">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-flashlight-line"></i> Custom events
                            </h3>
                            <div class="chart-card__actions">
                                <span id="custom-events-annotation" class="text-sm text-secondary"></span>
                            </div>
                        </div>
                        <div class="chart-card__container chart-card__container--short">
                            <canvas id="chart-custom-events"></canvas>
                        </div>
                    </div>

                    <!-- Revenue -->
                    <div class="card mt-lg" id="revenue-section" style="display: none;">
                        <div class="chart-card__header mb-lg">
                            <h3 class="chart-card__title">
                                <i class="ri-money-dollar-circle-line"></i> Revenue
                            </h3>
                        </div>

                        <!-- Revenue Guide (collapsible) -->
                        <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); overflow: hidden;">
                            <button id="revenue-guide-toggle" aria-expanded="false" style="width: 100%; display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; cursor: pointer; color: var(--color-text-primary); font-weight: var(--font-weight-medium); font-size: var(--font-size-sm);">
                                <span><i class="ri-question-line" style="margin-right: 0.5rem; color: var(--color-primary);"></i> Revenue tracking guide</span>
                                <i class="ri-arrow-down-s-line"></i>
                            </button>
                            <div id="revenue-guide-content" style="display: none; padding: 0 var(--spacing-lg) var(--spacing-lg); font-size: var(--font-size-sm); line-height: 1.6;">
                                <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                                    Track monetary value alongside events using the existing <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">MiniNumbers.track()</code> API. Include a <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">revenue</code> property to attribute income to specific actions.
                                </p>

                                <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Setup examples</h4>
                                <pre style="background: var(--color-bg-primary); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--spacing-sm) var(--spacing-md); font-size: 0.8rem; overflow-x: auto; margin-bottom: var(--spacing-md);"><span style="color: var(--color-text-muted);">// E-commerce purchase</span>
MiniNumbers.track("purchase", {
  revenue: 49.99, currency: "USD", product: "Pro Plan"
});

<span style="color: var(--color-text-muted);">// SaaS subscription</span>
MiniNumbers.track("subscription", {
  revenue: 9.99, currency: "USD", plan: "monthly"
});

<span style="color: var(--color-text-muted);">// One-time payment</span>
MiniNumbers.track("donation", {
  revenue: 25.00, currency: "EUR"
});</pre>

                                <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Framework integrations</h4>
                                <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                                    <li><strong>Stripe:</strong> In your checkout success callback, call <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">MiniNumbers.track("purchase", { revenue: amount })</code></li>
                                    <li><strong>Shopify:</strong> Add the tracking call to your order confirmation page <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">thank_you</code> template</li>
                                    <li><strong>WooCommerce:</strong> Hook into <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">woocommerce_thankyou</code> and output the tracking call</li>
                                    <li><strong>Generic forms:</strong> Fire the track call in your payment success handler</li>
                                </ul>

                                <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">How to interpret the data</h4>
                                <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                                    <li><strong>Total Revenue</strong> &mdash; aggregate income in the selected period with comparison to the previous period</li>
                                    <li><strong>Average Order Value (AOV)</strong> &mdash; mean revenue per transaction; use it to spot pricing opportunities</li>
                                    <li><strong>Revenue per Visitor</strong> &mdash; key metric for traffic quality; higher = better-converting traffic</li>
                                    <li><strong>Revenue Attribution</strong> &mdash; which referrers and UTM campaigns generate actual revenue, not just clicks</li>
                                    <li><strong>Revenue by Event</strong> &mdash; which actions (purchases, subscriptions, upgrades) drive the most income</li>
                                </ul>

                                <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Best practices</h4>
                                <ul style="color: var(--color-text-secondary); padding-left: 1.25rem;">
                                    <li>Always include <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px;">currency</code> for multi-currency support</li>
                                    <li>Track at the point of confirmed payment, not intent</li>
                                    <li>Use meaningful event names that map to your business model</li>
                                    <li>Combine with UTM parameters for full attribution</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Revenue Stat Cards (proper styling) -->
                        <div class="grid grid-cols-4" style="margin-bottom: var(--spacing-lg);">
                            <div class="card stat-card" style="text-align: center;">
                                <div class="stat-card__header" style="justify-content: center;">
                                    <div class="stat-card__icon" aria-hidden="true"><i class="ri-money-dollar-circle-line"></i></div>
                                    <small>Total Revenue</small>
                                </div>
                                <div class="stat-card__value" id="revenue-total" style="font-size: var(--font-size-2xl);">$0.00</div>
                            </div>
                            <div class="card stat-card" style="text-align: center;">
                                <div class="stat-card__header" style="justify-content: center;">
                                    <div class="stat-card__icon" aria-hidden="true"><i class="ri-shopping-cart-line"></i></div>
                                    <small>AOV</small>
                                </div>
                                <div class="stat-card__value" id="revenue-aov" style="font-size: var(--font-size-2xl);">$0.00</div>
                            </div>
                            <div class="card stat-card" style="text-align: center;">
                                <div class="stat-card__header" style="justify-content: center;">
                                    <div class="stat-card__icon" aria-hidden="true"><i class="ri-user-star-line"></i></div>
                                    <small>Revenue / Visitor</small>
                                </div>
                                <div class="stat-card__value" id="revenue-rpv" style="font-size: var(--font-size-2xl);">$0.00</div>
                            </div>
                            <div class="card stat-card" style="text-align: center;">
                                <div class="stat-card__header" style="justify-content: center;">
                                    <div class="stat-card__icon" aria-hidden="true"><i class="ri-exchange-line"></i></div>
                                    <small>Transactions</small>
                                </div>
                                <div class="stat-card__value" id="revenue-transactions" style="font-size: var(--font-size-2xl);">0</div>
                            </div>
                        </div>

                        <!-- Revenue by Event -->
                        <div class="chart-card__header" style="margin-bottom: var(--spacing-sm);">
                            <h3 class="chart-card__title" style="font-size: var(--font-size-lg);">
                                <i class="ri-bar-chart-grouped-line"></i> Revenue by event
                            </h3>
                        </div>
                        <div id="revenue-breakdown" style="margin-bottom: var(--spacing-lg);">
                            <div style="color: var(--color-text-muted); text-align: center; padding: 1rem;">Loading...</div>
                        </div>

                        <!-- Revenue Attribution Table -->
                        <div class="chart-card__header" style="margin-bottom: var(--spacing-sm);">
                            <h3 class="chart-card__title" style="font-size: var(--font-size-lg);">
                                <i class="ri-links-line"></i> Revenue attribution
                            </h3>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Source</th>
                                        <th>Revenue</th>
                                        <th>Transactions</th>
                                        <th>Avg Value</th>
                                        <th>Conv. Rate</th>
                                    </tr>
                                </thead>
                                <tbody id="revenue-attribution-body">
                                    <tr><td colspan="5" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 7: REAL-TIME
                 ============================================ -->
            <section class="dashboard-section" data-section="realtime" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-realtime-content">
                    <div class="dashboard-section__title">
                        <i class="ri-radar-line"></i>
                        <div>
                            <h2>Real-Time</h2>
                            <p>Visitors currently active on your site in the last 5 minutes — live page views, locations, and a real-time counter.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-realtime-content">
                    <!-- Real-time Visitors + Live Feed (merged) -->
                    <div class="card" id="realtime-section" role="region" aria-label="Live visitor feed">
                        <div class="chart-card__header">
                            <h3 class="chart-card__title">
                                <i class="ri-live-line"></i>
                                <span class="live-indicator" aria-hidden="true"></span>
                                Live feed (last 5 minutes)
                            </h3>
                            <div class="chart-card__actions">
                                <button class="btn btn-ghost btn-sm" id="realtime-demo-btn" title="Show demo data">
                                    <i class="ri-map-pin-line"></i> Demo
                                </button>
                                <div class="realtime-count">
                                    <span class="realtime-count__number" id="realtime-number">0</span>
                                    <span class="realtime-count__label">active now</span>
                                </div>
                            </div>
                        </div>
                        <div id="live-feed" class="live-feed" role="log" aria-live="polite" aria-label="Real-time visitor activity">
                            Waiting for data...
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================
                 SECTION 8: CONVERSIONS
                 ============================================ -->
            <section class="dashboard-section" data-section="conversions" aria-expanded="false">
                <button class="dashboard-section__header" aria-expanded="false" aria-controls="section-conversions-content">
                    <div class="dashboard-section__title">
                        <i class="ri-focus-3-line"></i>
                        <div>
                            <h2>Conversions</h2>
                            <p>Conversion goals with completion rates, multi-step funnels showing drop-off at each stage, and custom audience segments for targeted analysis.</p>
                        </div>
                    </div>
                    <i class="ri-arrow-down-s-line dashboard-section__chevron"></i>
                </button>
                <div class="dashboard-section__content" id="section-conversions-content">
                    <!-- Conversion Goals -->
                    <div class="card" id="goals-section" style="display: none;">
                        <div class="chart-card__header mb-lg">
                            <h3 class="chart-card__title">
                                <i class="ri-focus-3-line"></i> Conversion goals
                            </h3>
                            <div class="chart-card__actions">
                                <button class="btn btn-primary btn-sm" id="manage-goals-btn">
                                    <i class="ri-settings-3-line"></i>
                                    <span>Manage goals</span>
                                </button>
                            </div>
                        </div>
                        <div id="goals-list">Loading...</div>
                    </div>

                    <!-- Funnels -->
                    <div class="card mt-lg" id="funnels-section" style="display: none;">
                        <div class="chart-card__header mb-lg">
                            <h3 class="chart-card__title">
                                <i class="ri-filter-3-line"></i> Funnels
                            </h3>
                            <div class="chart-card__actions">
                                <button class="btn btn-primary btn-sm" id="manage-funnels-btn">
                                    <i class="ri-settings-3-line"></i>
                                    <span>Manage funnels</span>
                                </button>
                            </div>
                        </div>
                        <div id="funnels-list">Loading...</div>
                    </div>

                    <!-- User Segments -->
                    <div class="card mt-lg" id="segments-section" style="display: none;">
                        <div class="chart-card__header mb-lg">
                            <h3 class="chart-card__title">
                                <i class="ri-equalizer-line"></i> User segments
                            </h3>
                            <div class="chart-card__actions">
                                <button class="btn btn-primary btn-sm" id="manage-segments-btn" aria-label="Manage user segments">
                                    <i class="ri-settings-3-line"></i>
                                    <span>Manage segments</span>
                                </button>
                            </div>
                        </div>
                        <div id="segments-list" role="list" aria-label="Segments list">Loading...</div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Demo Data Generator Modal -->
    <div id="demo-data-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Generate demo data</h2>
                <button class="modal-close" id="close-demo-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Generate realistic dummy analytics data for testing purposes.</p>
                <div class="form-group">
                    <label for="demo-count">Number of events (0-3000):</label>
                    <input type="number" id="demo-count" class="input" min="0" max="3000" value="500" />
                </div>
                <div class="form-group">
                    <label for="demo-time-scope">Time scope:</label>
                    <select id="demo-time-scope" class="select">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="365">Last year</option>
                    </select>
                    <small class="help-text">Events will be randomly distributed over this period</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="cancel-demo-btn">Cancel</button>
                <button class="btn btn-primary" id="confirm-demo-btn">Generate</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Create Project Modal -->
    <div id="create-project-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="create-project-title">Create new project</h2>
                <button class="modal-close" id="close-create-project">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Step indicator -->
                <div class="step-indicator" id="create-step-indicator">
                    <div class="step-dot active" data-step="1"></div>
                    <div class="step-dot" data-step="2"></div>
                </div>

                <!-- Step 1: Project details -->
                <div id="create-step-1">
                    <div class="form-group">
                        <label for="project-name">
                            <i class="ri-price-tag-3-line form-icon"></i>
                            Project name
                        </label>
                        <input type="text" id="project-name" class="input" placeholder="My Website" required />
                        <small class="help-text">A friendly name to identify your project</small>
                        <div class="field-error" id="project-name-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="project-domain">
                            <i class="ri-global-line form-icon"></i>
                            Domain
                        </label>
                        <input type="text" id="project-domain" class="input" placeholder="example.com" required />
                        <small class="help-text">Enter without https:// or www. prefix</small>
                        <div class="field-error" id="project-domain-error"></div>
                    </div>
                    <div class="form-group">
                        <label>
                            <i class="ri-key-line form-icon"></i>
                            API key (pre-generated)
                        </label>
                        <div class="api-key-display">
                            <code id="generated-api-key">...</code>
                            <button type="button" class="btn btn-ghost btn-icon" id="copy-api-key" title="Copy to clipboard">
                                <i class="ri-file-copy-line"></i>
                            </button>
                        </div>
                        <small class="help-text">This key will be assigned to your project</small>
                    </div>
                </div>

                <!-- Step 2: Success + tracking snippet -->
                <div id="create-step-2" style="display: none;">
                    <div class="create-success">
                        <div class="create-success__icon">
                            <i class="ri-checkbox-circle-line"></i>
                        </div>
                        <h3>Project created!</h3>
                        <p class="text-muted">Add this snippet to your website's <code>&lt;head&gt;</code> to start tracking:</p>
                    </div>
                    <div class="snippet-block">
                        <pre id="tracking-snippet-code"></pre>
                        <button type="button" class="btn btn-ghost btn-icon snippet-copy" id="copy-snippet" title="Copy snippet">
                            <i class="ri-file-copy-line"></i>
                        </button>
                    </div>
                    <div class="form-group" style="margin-top: var(--spacing-md);">
                        <label>API key</label>
                        <div class="api-key-display">
                            <code id="generated-api-key-final">...</code>
                            <button type="button" class="btn btn-ghost btn-icon" id="copy-api-key-final" title="Copy API key">
                                <i class="ri-file-copy-line"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="cancel-create-project">Cancel</button>
                <button class="btn btn-primary" id="confirm-create-project">Create project</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Project Information Section -->
                <div id="project-settings-section" style="display: none;">
                    <h3 style="margin-top: 0; margin-bottom: var(--spacing-md); font-size: var(--font-size-lg); border-bottom: 1px solid var(--color-border); padding-bottom: var(--spacing-sm);">Project information</h3>

                    <div class="form-group">
                        <label for="setting-project-name">Project name*</label>
                        <input type="text" id="setting-project-name" class="input" placeholder="My Website" />
                    </div>

                    <div class="form-group">
                        <label>Domain (read-only)</label>
                        <input type="text" id="setting-project-domain" class="input" readonly style="background: var(--color-bg-tertiary); cursor: not-allowed;" />
                    </div>

                    <div class="form-group">
                        <label>Tracking ID (read-only)</label>
                        <div class="api-key-display">
                            <code id="setting-project-api-key">...</code>
                            <button class="btn btn-ghost btn-icon" id="copy-project-api-key" title="Copy to clipboard">
                                <i class="ri-file-copy-line"></i>
                            </button>
                        </div>
                    </div>

                    <h3 style="margin-top: var(--spacing-lg); margin-bottom: var(--spacing-md); font-size: var(--font-size-lg); border-bottom: 1px solid var(--color-border); padding-bottom: var(--spacing-sm);">Dashboard preferences</h3>
                </div>

                <!-- Dashboard Settings Section -->
                <div class="form-group">
                    <label for="setting-time-format">Time format</label>
                    <select id="setting-time-format" class="select">
                        <option value="24h">24-hour (13:00)</option>
                        <option value="12h">12-hour (1:00 PM)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="setting-date-format">Date format</label>
                    <select id="setting-date-format" class="select">
                        <option value="MM/DD/YYYY">MM/DD/YYYY (US)</option>
                        <option value="DD/MM/YYYY">DD/MM/YYYY (EU)</option>
                        <option value="YYYY-MM-DD">YYYY-MM-DD (ISO)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="setting-heatmap-colors">Activity heatmap colors</label>
                    <select id="setting-heatmap-colors" class="select">
                        <option value="blue">Blue (Default)</option>
                        <option value="green">Green (GitHub-style)</option>
                        <option value="purple">Purple</option>
                        <option value="orange">Orange</option>
                    </select>
                </div>

                <!-- Export Report Section -->
                <h3 style="margin-top: var(--spacing-lg); margin-bottom: var(--spacing-md); font-size: var(--font-size-lg); border-bottom: 1px solid var(--color-border); padding-bottom: var(--spacing-sm);">Export report</h3>
                <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">Select which data to include in the downloadable CSV report.</p>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="views-visitors" checked> Page views & visitors
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="top-pages" checked> Top pages
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="referrers" checked> Referrers
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="utm-campaigns"> UTM campaigns
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="tech" checked> Browsers / OS / Devices
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="countries" checked> Countries & regions
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="custom-events"> Custom events
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="revenue"> Revenue attribution
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: var(--font-size-sm);">
                        <input type="checkbox" class="export-section-cb" value="raw-events"> Raw events <span class="text-muted">(large file)</span>
                    </label>
                </div>
                <button class="btn btn-primary btn-sm" id="download-report-btn">
                    <i class="ri-download-line"></i> Download report
                </button>

                <!-- Automations Section -->
                <h3 style="margin-top: var(--spacing-lg); margin-bottom: var(--spacing-md); font-size: var(--font-size-lg); border-bottom: 1px solid var(--color-border); padding-bottom: var(--spacing-sm);">Automations</h3>
                <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                    <button class="btn btn-ghost btn-sm" id="manage-webhooks-btn">
                        <i class="ri-webhook-line"></i>
                        <span>Manage webhooks</span>
                    </button>
                    <button class="btn btn-ghost btn-sm" id="manage-email-reports-btn" aria-label="Manage email reports">
                        <i class="ri-mail-send-line"></i>
                        <span>Manage email reports</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="cancel-settings">Cancel</button>
                <button class="btn btn-primary" id="save-settings">Save settings</button>
            </div>
        </div>
    </div>

    <!-- Raw Events Viewer Modal -->
    <div id="raw-events-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2>Raw Events</h2>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <button class="btn btn-ghost btn-icon" id="export-raw-events" title="Export to CSV">
                        <i class="ri-download-line"></i>
                    </button>
                    <button class="modal-close" id="close-raw-events">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                    <select id="raw-events-type" class="select">
                        <option value="">All event types</option>
                        <option value="pageview">Pageviews</option>
                        <option value="heartbeat">Heartbeats</option>
                        <option value="custom">Custom events</option>
                    </select>
                    <select id="raw-events-sort" class="select">
                        <option value="timestamp-desc">Newest first</option>
                        <option value="timestamp-asc">Oldest first</option>
                        <option value="path-asc">Path (A-Z)</option>
                        <option value="country-asc">Country (A-Z)</option>
                    </select>
                </div>

                <div class="table-container">
                    <table id="raw-events-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Type</th>
                                <th>Path</th>
                                <th>Location</th>
                                <th>Browser</th>
                                <th>Device</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody id="raw-events-tbody">
                            <tr><td colspan="7" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 1rem;">
                    <div id="raw-events-info" style="font-size: 0.875rem; color: var(--color-text-muted);">Showing 0-0 of 0</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-ghost btn-sm" id="raw-events-prev" disabled>Previous</button>
                        <button class="btn btn-ghost btn-sm" id="raw-events-next">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goals Management Modal -->
    <div id="goals-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2>Manage conversion goals</h2>
                <button class="modal-close" id="close-goals-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <h3 style="margin-top: 0;">Create new goal</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="flex: 1; min-width: 150px;">
                            <label for="goal-name">Name</label>
                            <input type="text" id="goal-name" class="input" placeholder="e.g. Visited Pricing">
                        </div>
                        <div class="form-group" style="min-width: 120px;">
                            <label for="goal-type">Type</label>
                            <select id="goal-type" class="select">
                                <option value="url">URL path</option>
                                <option value="event">Custom event</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1; min-width: 150px;">
                            <label for="goal-match-value">Match value</label>
                            <input type="text" id="goal-match-value" class="input" placeholder="e.g. /pricing or signup">
                        </div>
                        <button class="btn btn-primary" id="create-goal-btn" style="margin-bottom: var(--spacing-md);">Create</button>
                    </div>
                </div>

                <h3>Existing goals</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Match value</th>
                                <th>Active</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="goals-table-body">
                            <tr><td colspan="5" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Funnels Management Modal -->
    <div id="funnels-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2>Manage funnels</h2>
                <button class="modal-close" id="close-funnels-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <h3 style="margin-top: 0;">Create new funnel</h3>
                    <div class="form-group">
                        <label for="funnel-name">Funnel name</label>
                        <input type="text" id="funnel-name" class="input" placeholder="e.g. Purchase Flow">
                    </div>

                    <label style="display: block; margin-bottom: var(--spacing-sm); font-weight: var(--font-weight-medium);">Steps</label>
                    <div id="funnel-steps-container">
                        <!-- Steps are dynamically rendered -->
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-top: var(--spacing-sm);">
                        <button class="btn btn-ghost btn-sm" id="add-funnel-step-btn">
                            <i class="ri-add-line"></i> Add step
                        </button>
                        <button class="btn btn-primary btn-sm" id="create-funnel-btn">Create funnel</button>
                    </div>
                </div>

                <h3>Existing funnels</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Steps</th>
                                <th>Flow</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="funnels-table-body">
                            <tr><td colspan="4" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Segments Management Modal -->
    <div id="segments-modal" class="modal" role="dialog" aria-labelledby="segments-modal-title" aria-modal="true">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2 id="segments-modal-title">Manage user segments</h2>
                <button class="modal-close" id="close-segments-modal" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <h3 style="margin-top: 0;">Create new segment</h3>
                    <div class="form-group">
                        <label for="segment-name">Segment name</label>
                        <input type="text" id="segment-name" class="input" placeholder="e.g. Mobile Chrome Users" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="segment-description">Description (optional)</label>
                        <input type="text" id="segment-description" class="input" placeholder="e.g. Users on Chrome mobile browser">
                    </div>

                    <label style="display: block; margin-bottom: var(--spacing-sm); font-weight: var(--font-weight-medium);">Filters</label>
                    <div id="segment-filters-container" role="list" aria-label="Segment filters">
                        <!-- Filters rendered dynamically -->
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-top: var(--spacing-sm);">
                        <button class="btn btn-ghost btn-sm" id="add-segment-filter-btn" aria-label="Add filter condition">
                            <i class="ri-add-line"></i> Add filter
                        </button>
                        <button class="btn btn-primary btn-sm" id="create-segment-btn">Create segment</button>
                    </div>
                </div>

                <h3>Existing segments</h3>
                <div class="table-container">
                    <table aria-label="Existing segments">
                        <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Description</th>
                                <th scope="col">Filters</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody id="segments-table-body">
                            <tr><td colspan="4" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Webhooks Management Modal -->
    <div id="webhooks-modal" class="modal" role="dialog" aria-labelledby="webhooks-modal-title" aria-modal="true">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2 id="webhooks-modal-title">Manage webhooks</h2>
                <button class="modal-close" id="close-webhooks-modal" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">

                <!-- Setup Guide (collapsible) -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); overflow: hidden;">
                    <button id="webhook-guide-toggle" aria-expanded="false" style="width: 100%; display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; cursor: pointer; color: var(--color-text-primary); font-weight: var(--font-weight-medium); font-size: var(--font-size-sm);">
                        <span><i class="ri-question-line" style="margin-right: 0.5rem; color: var(--color-primary);"></i> How to set up webhooks</span>
                        <i class="ri-arrow-down-s-line"></i>
                    </button>
                    <div id="webhook-guide-content" style="display: none; padding: 0 var(--spacing-lg) var(--spacing-lg); font-size: var(--font-size-sm); line-height: 1.6;">
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                            Webhooks let Mini Numbers send real-time HTTP POST notifications to your server when important events occur. You can use them to trigger Slack alerts, update dashboards, or integrate with any external service.
                        </p>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Supported event types</h4>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                            <li><strong>goal_conversion</strong> &mdash; Fires when a visitor triggers one of your active conversion goals (URL visit or custom event match).</li>
                            <li><strong>traffic_spike</strong> &mdash; Fires when incoming traffic exceeds 2&times; the rolling average rate, indicating an unusual surge.</li>
                        </ul>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Payload format</h4>
                        <pre style="background: var(--color-bg-primary); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--spacing-sm) var(--spacing-md); font-size: 0.8rem; overflow-x: auto;">{
  "event": "goal_conversion",
  "projectId": "uuid-here",
  "goalName": "Signup",
  "goalType": "event",
  "matchValue": "signup",
  "timestamp": "2026-02-27T14:30:00",
  "path": "/pricing",
  "eventName": "signup"
}</pre>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">HMAC signature verification</h4>
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">Every delivery includes an <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.85em;">X-MiniNumbers-Signature</code> header. Verify it to ensure the request is authentic:</p>
                        <pre style="background: var(--color-bg-primary); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--spacing-sm) var(--spacing-md); font-size: 0.8rem; overflow-x: auto;"><span style="color: var(--color-text-muted);">// Node.js</span>
const crypto = require('crypto');
const signature = req.headers['x-mininumbers-signature'];
const expected = 'sha256=' + crypto
  .createHmac('sha256', YOUR_WEBHOOK_SECRET)
  .update(JSON.stringify(req.body))
  .digest('hex');
const valid = crypto.timingSafeEqual(
  Buffer.from(signature), Buffer.from(expected)
);

<span style="color: var(--color-text-muted);"># Python</span>
import hmac, hashlib
signature = request.headers['X-MiniNumbers-Signature']
expected = 'sha256=' + hmac.new(
    SECRET.encode(), request.data, hashlib.sha256
).hexdigest()
valid = hmac.compare_digest(signature, expected)</pre>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Setup steps</h4>
                        <ol style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                            <li>Create an HTTPS endpoint on your server that accepts POST requests.</li>
                            <li>Add the webhook URL below and select which events to subscribe to.</li>
                            <li>Save the HMAC secret shown after creation &mdash; it&rsquo;s only displayed once.</li>
                            <li>Use <strong>Send Test</strong> to verify your endpoint receives the delivery.</li>
                            <li>Check the <strong>Delivery log</strong> to monitor success/failure status.</li>
                        </ol>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Integration recipes</h4>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                            <li><strong>Slack:</strong> Use an <a href="https://api.slack.com/messaging/webhooks" target="_blank" rel="noopener">Incoming Webhook URL</a> &mdash; paste the Slack webhook URL directly.</li>
                            <li><strong>Discord:</strong> Create a webhook in Channel Settings &rarr; Integrations &rarr; use the <code style="background: var(--color-bg-primary); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.85em;">/slack</code> suffix for Slack-compatible format.</li>
                            <li><strong>Zapier:</strong> Create a &ldquo;Catch Hook&rdquo; trigger and paste the Zapier webhook URL.</li>
                            <li><strong>Custom server:</strong> Any HTTPS endpoint that returns 2xx on success.</li>
                        </ul>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Troubleshooting</h4>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem;">
                            <li>URLs must use <strong>HTTPS</strong> &mdash; HTTP is rejected for security.</li>
                            <li>Your endpoint must respond within <strong>10 seconds</strong> or the delivery is marked as failed.</li>
                            <li>Failed deliveries are <strong>retried up to 3 times</strong> with exponential backoff (5s, 10s, 15s).</li>
                            <li>Check the delivery log for response codes &mdash; 4xx errors are not retried.</li>
                        </ul>
                    </div>
                </div>

                <!-- Create Form -->
                <div class="form-section">
                    <h3 style="margin-top: 0;">Add new webhook</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="flex: 2; min-width: 250px;">
                            <label for="webhook-url">Webhook URL (HTTPS)</label>
                            <input type="url" id="webhook-url" class="input" placeholder="https://your-server.com/webhook">
                        </div>
                        <button class="btn btn-primary" id="create-webhook-btn" style="margin-bottom: var(--spacing-md);">Add webhook</button>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: var(--spacing-xs);">
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                            <input type="checkbox" class="webhook-event-cb" value="goal_conversion" checked> goal_conversion
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                            <input type="checkbox" class="webhook-event-cb" value="traffic_spike" checked> traffic_spike
                        </label>
                    </div>
                </div>

                <!-- Secret Display (shown once after creation) -->
                <div id="webhook-secret-display" style="display: none; background: var(--color-warning-bg, #fef3c7); border: 1px solid var(--color-warning, #f59e0b); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <p style="font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-xs);">
                        <i class="ri-key-line" style="color: var(--color-warning, #f59e0b);"></i>
                        Webhook secret (save it now &mdash; it won&rsquo;t be shown again):
                    </p>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <code class="webhook-secret-value" style="flex: 1; background: var(--color-bg-primary); padding: var(--spacing-sm); border-radius: var(--radius-sm); font-size: var(--font-size-sm); word-break: break-all;"></code>
                        <button class="btn btn-ghost btn-sm copy-secret-btn" onclick="WebhooksManager.copySecret()">Copy</button>
                    </div>
                </div>

                <!-- Existing Webhooks Table -->
                <h3>Existing webhooks</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Events</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="webhooks-table-body">
                            <tr><td colspan="4" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Delivery Log (shown when viewing a webhook's deliveries) -->
                <div id="webhook-deliveries-section" style="display: none; margin-top: var(--spacing-lg);">
                    <h3><i class="ri-file-list-line"></i> Delivery log</h3>
                    <div id="webhook-deliveries-log"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Reports Modal -->
    <div id="email-reports-modal" class="modal" role="dialog" aria-labelledby="email-reports-modal-title" aria-modal="true">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--wide">
            <div class="modal-header">
                <h2 id="email-reports-modal-title">Manage email reports</h2>
                <button class="modal-close" id="close-email-reports-modal" aria-label="Close dialog">&times;</button>
            </div>
            <div class="modal-body">

                <!-- SMTP Status -->
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: var(--spacing-lg); padding: var(--spacing-sm) var(--spacing-md); background: var(--color-bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--color-border);">
                    <span style="font-weight: var(--font-weight-medium); font-size: var(--font-size-sm);">SMTP Status:</span>
                    <span id="smtp-status-indicator" style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Checking...</span>
                </div>

                <!-- SMTP Setup Guide (collapsible) -->
                <div style="background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: var(--radius-lg); margin-bottom: var(--spacing-lg); overflow: hidden;">
                    <button id="email-guide-toggle" aria-expanded="false" style="width: 100%; display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; cursor: pointer; color: var(--color-text-primary); font-weight: var(--font-weight-medium); font-size: var(--font-size-sm);">
                        <span><i class="ri-question-line" style="margin-right: 0.5rem; color: var(--color-primary);"></i> SMTP setup guide &amp; email report configuration</span>
                        <i class="ri-arrow-down-s-line"></i>
                    </button>
                    <div id="email-guide-content" style="display: none; padding: 0 var(--spacing-lg) var(--spacing-lg); font-size: var(--font-size-sm); line-height: 1.6;">

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">What is SMTP?</h4>
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                            SMTP (Simple Mail Transfer Protocol) is needed to send emails from Mini Numbers. You need access to an SMTP server &mdash; either from your email provider or a transactional email service. Configure it via environment variables before starting the server.
                        </p>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Environment variables</h4>
                        <div class="table-container" style="margin-bottom: var(--spacing-md);">
                            <table style="font-size: 0.8rem;">
                                <thead>
                                    <tr><th>Variable</th><th>Required</th><th>Default</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td><code>SMTP_HOST</code></td><td>Yes</td><td>&mdash;</td><td>SMTP server hostname</td></tr>
                                    <tr><td><code>SMTP_PORT</code></td><td>No</td><td>587</td><td>SMTP server port</td></tr>
                                    <tr><td><code>SMTP_USERNAME</code></td><td>No</td><td>&mdash;</td><td>SMTP authentication username</td></tr>
                                    <tr><td><code>SMTP_PASSWORD</code></td><td>No</td><td>&mdash;</td><td>SMTP authentication password</td></tr>
                                    <tr><td><code>SMTP_FROM</code></td><td>Yes</td><td>&mdash;</td><td>Sender email address</td></tr>
                                    <tr><td><code>SMTP_STARTTLS</code></td><td>No</td><td>true</td><td>Enable STARTTLS encryption</td></tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Provider setup examples</h4>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                            <li><strong>Gmail:</strong> Use <code>smtp.gmail.com</code> port 587. You must create an <a href="https://support.google.com/accounts/answer/185833" target="_blank" rel="noopener">App Password</a> (2FA required).</li>
                            <li><strong>SendGrid:</strong> Use <code>smtp.sendgrid.net</code> port 587, username <code>apikey</code>, password is your API key.</li>
                            <li><strong>Mailgun:</strong> Use <code>smtp.mailgun.org</code> port 587 with your domain credentials.</li>
                            <li><strong>Amazon SES:</strong> Use your region endpoint (e.g. <code>email-smtp.us-east-1.amazonaws.com</code>) port 587 with SMTP credentials from the SES console.</li>
                            <li><strong>Self-hosted (Postfix, etc.):</strong> Use <code>localhost</code> port 25 or 587. You may skip username/password if relay is configured.</li>
                        </ul>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Example <code>.env</code> configuration</h4>
                        <pre style="background: var(--color-bg-primary); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--spacing-sm) var(--spacing-md); font-size: 0.8rem; overflow-x: auto;">SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=you@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=analytics@yourdomain.com
SMTP_STARTTLS=true</pre>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Report contents</h4>
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">
                            Each email report includes a professional HTML summary of your analytics for the selected period. Use the section checkboxes below to control what&rsquo;s included:
                        </p>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem; margin-bottom: var(--spacing-md);">
                            <li><strong>Overview</strong> &mdash; total views, unique visitors, bounce rate with period comparison</li>
                            <li><strong>Top pages</strong> &mdash; your most-visited pages ranked by traffic</li>
                            <li><strong>Referrers</strong> &mdash; where your visitors are coming from</li>
                            <li><strong>Geographic</strong> &mdash; top countries and cities</li>
                            <li><strong>Custom events</strong> &mdash; tracked events by name and count</li>
                        </ul>

                        <h4 style="margin: var(--spacing-md) 0 var(--spacing-sm);">Troubleshooting</h4>
                        <ul style="color: var(--color-text-secondary); padding-left: 1.25rem;">
                            <li>If SMTP status shows &ldquo;Not configured&rdquo;, verify your environment variables and restart the server.</li>
                            <li>Gmail requires an App Password &mdash; regular passwords are blocked for SMTP.</li>
                            <li>Check your spam/junk folder if test emails don&rsquo;t arrive.</li>
                            <li>Port 465 uses implicit SSL; port 587 uses STARTTLS. Most providers recommend 587.</li>
                            <li>Scheduled reports are checked every hour. Daily reports send at your configured hour; weekly on Monday; monthly on the 1st.</li>
                        </ul>
                    </div>
                </div>

                <!-- Create New Report Form -->
                <div class="form-section" style="margin-bottom: var(--spacing-lg);">
                    <h3 style="margin-top: 0;">Add new email report</h3>

                    <!-- Basic settings -->
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="flex: 2; min-width: 200px;">
                            <label for="email-report-recipient">Recipient email</label>
                            <input type="email" id="email-report-recipient" class="input" placeholder="you@example.com">
                        </div>
                        <div class="form-group" style="flex: 1; min-width: 120px;">
                            <label for="email-report-schedule">Frequency</label>
                            <select id="email-report-schedule" class="select">
                                <option value="DAILY">Daily</option>
                                <option value="WEEKLY" selected>Weekly</option>
                                <option value="MONTHLY">Monthly</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 0; min-width: 80px;">
                            <label for="email-report-hour">Send hour</label>
                            <select id="email-report-hour" class="select">
                                <option value="6">06:00</option>
                                <option value="7">07:00</option>
                                <option value="8" selected>08:00</option>
                                <option value="9">09:00</option>
                                <option value="10">10:00</option>
                                <option value="12">12:00</option>
                                <option value="18">18:00</option>
                            </select>
                        </div>
                    </div>

                    <!-- Report sections -->
                    <div style="margin-top: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                        <label style="font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); display: block; margin-bottom: var(--spacing-xs);">Include sections:</label>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                                <input type="checkbox" class="email-section-cb" value="overview" checked> Overview
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                                <input type="checkbox" class="email-section-cb" value="pages" checked> Top pages
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                                <input type="checkbox" class="email-section-cb" value="referrers" checked> Referrers
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                                <input type="checkbox" class="email-section-cb" value="geo" checked> Geographic
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.25rem; cursor: pointer; font-size: var(--font-size-sm);">
                                <input type="checkbox" class="email-section-cb" value="events" checked> Custom events
                            </label>
                        </div>
                    </div>

                    <!-- Template customization (collapsible) -->
                    <details style="margin-bottom: var(--spacing-md);">
                        <summary style="cursor: pointer; font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">
                            <i class="ri-palette-line" style="margin-right: 0.25rem;"></i> Customize template (optional)
                        </summary>
                        <div style="padding-top: var(--spacing-sm);">
                            <div class="form-group">
                                <label for="email-report-subject" style="font-size: var(--font-size-sm);">Subject line</label>
                                <input type="text" id="email-report-subject" class="input" placeholder="{project_name} Analytics &#8212; {period}" style="font-size: var(--font-size-sm);">
                                <small class="help-text">Variables: {project_name}, {period}, {date}</small>
                            </div>
                            <div class="form-group">
                                <label for="email-report-header" style="font-size: var(--font-size-sm);">Header text</label>
                                <input type="text" id="email-report-header" class="input" placeholder="e.g. Your weekly analytics summary" style="font-size: var(--font-size-sm);">
                            </div>
                            <div class="form-group">
                                <label for="email-report-footer" style="font-size: var(--font-size-sm);">Footer text</label>
                                <input type="text" id="email-report-footer" class="input" placeholder="e.g. Powered by Mini Numbers" style="font-size: var(--font-size-sm);">
                            </div>
                        </div>
                    </details>

                    <button class="btn btn-primary" id="create-email-report-btn">
                        <i class="ri-add-line"></i> Create report schedule
                    </button>
                </div>

                <!-- Existing Reports Table -->
                <h3>Scheduled reports</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Recipient</th>
                                <th>Schedule</th>
                                <th>Status</th>
                                <th>Last sent</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="email-reports-table-body">
                            <tr><td colspan="5" style="text-align: center; color: var(--color-text-muted);">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Onboarding Checklist Modal -->
    <div id="onboarding-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Welcome to Mini Numbers!</h2>
                <button class="modal-close" id="close-onboarding">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-lg);">
                    Get started with privacy-first analytics in a few simple steps.
                </p>
                <div class="onboarding-checklist" id="onboarding-checklist">
                    <div class="onboarding-step" data-step="create-project">
                        <div class="onboarding-step__check"></div>
                        <div class="onboarding-step__content">
                            <div class="onboarding-step__title">Create your first project</div>
                            <div class="onboarding-step__desc">Set up a project for each website you want to track</div>
                        </div>
                    </div>
                    <div class="onboarding-step" data-step="install-tracker">
                        <div class="onboarding-step__check"></div>
                        <div class="onboarding-step__content">
                            <div class="onboarding-step__title">Install the tracking script</div>
                            <div class="onboarding-step__desc">Add the lightweight script tag to your website's HTML</div>
                        </div>
                    </div>
                    <div class="onboarding-step" data-step="first-visit">
                        <div class="onboarding-step__check"></div>
                        <div class="onboarding-step__content">
                            <div class="onboarding-step__title">Receive your first visit</div>
                            <div class="onboarding-step__desc">Visit your website to verify tracking is working</div>
                        </div>
                    </div>
                    <div class="onboarding-step" data-step="explore-dashboard">
                        <div class="onboarding-step__check"></div>
                        <div class="onboarding-step__content">
                            <div class="onboarding-step__title">Explore the dashboard</div>
                            <div class="onboarding-step__desc">View analytics, set up goals, and customize settings</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="dismiss-onboarding">Skip for now</button>
                <button class="btn btn-primary" id="close-onboarding-done">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logout-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-content--compact">
            <div class="logout-dialog">
                <div class="logout-dialog__icon">
                    <i class="ri-logout-box-r-line"></i>
                </div>
                <h2 class="logout-dialog__title">Sign out</h2>
                <p class="logout-dialog__message">Are you sure you want to sign out of your account?</p>
                <div class="logout-dialog__actions">
                    <button class="btn btn-ghost" id="cancel-logout">Cancel</button>
                    <button class="btn btn-danger" id="confirm-logout">Sign out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Project Confirmation Modal -->
    <div id="delete-project-modal" class="modal">
        <div class="modal-backdrop" onclick="document.getElementById('delete-project-modal').classList.remove('show')"></div>
        <div class="modal-content modal-content--compact">
            <div class="logout-dialog">
                <div class="logout-dialog__icon" style="color: var(--color-danger);">
                    <i class="ri-delete-bin-line"></i>
                </div>
                <h2 class="logout-dialog__title">Delete project</h2>
                <p class="logout-dialog__message">Are you sure you want to delete <strong id="delete-project-name"></strong>? This will permanently remove all analytics data, goals, funnels, and segments.</p>
                <div class="logout-dialog__actions">
                    <button class="btn btn-ghost" onclick="document.getElementById('delete-project-modal').classList.remove('show')">Cancel</button>
                    <button class="btn btn-danger" onclick="Dashboard.deleteProject(document.getElementById('delete-project-modal').dataset.projectId)">Delete project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="/admin-panel/js/theme.js"></script>
    <script src="/admin-panel/js/settings.js"></script>
    <script src="/admin-panel/js/utils.js"></script>
    <script src="/admin-panel/js/charts.js"></script>
    <script src="/admin-panel/js/map.js"></script>
    <script src="/admin-panel/js/globe.js"></script>
    <script src="/admin-panel/js/goals.js"></script>
    <script src="/admin-panel/js/segments.js"></script>
    <script src="/admin-panel/js/webhooks.js"></script>
    <script src="/admin-panel/js/email-reports.js"></script>
    <script src="/admin-panel/js/revenue.js"></script>
    <script src="/admin-panel/js/admin.js"></script>

</body>
</html>
